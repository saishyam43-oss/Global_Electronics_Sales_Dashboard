ðŸ”µ REGIONAL REVENUE, PROFIT & MARGIN
/*
    Measure: Revenue by Country
    Old Name: Revenue (Country)
    Purpose: Returns total revenue for the selected country or region.
*/
Revenue by Country :=
CALCULATE([Revenue Total], 'stores'[Country])

/*
    Measure: Profit by Country
    Old Name: Profit (Country)
    Purpose: Shows profit contribution from each country.
*/
Profit by Country :=
CALCULATE([Profit Total], 'stores'[Country])

/*
    Measure: Profit Margin Percentage by Country
    Old Name: Profit Margin % (Country)
    Purpose: Margin percentage for each country. Used in map and bar visuals.
*/
Profit Margin Percentage by Country :=
DIVIDE([Profit by Country], [Revenue by Country])

/*
    Measure: Revenue Share Percentage (Country)
    Old Name: Revenue Share % (Country)
    Purpose: Countryâ€™s share of global revenue. Useful in regional comparisons.
*/
Revenue Share Percentage (Country) :=
DIVIDE([Revenue by Country], [Revenue Without Filters])

	
ðŸ”µ REGIONAL YoY GROWTH
/*
    Measure: Revenue Last Year (Country)
    Old Name: Revenue LY (Country)
    Purpose: Pulls last year's country-level revenue for YoY analysis.
*/
Revenue Last Year (Country) :=
CALCULATE([Revenue by Country], SAMEPERIODLASTYEAR('Calendar'[Date]))

/*
    Measure: Revenue YoY % Change (Country)
    Old Name: Revenue Growth YoY % (Country)
    Purpose: Shows YoY % movement in country-level revenue.
*/
Revenue YoY % Change (Country) :=
DIVIDE(
    [Revenue by Country] - [Revenue Last Year (Country)],
    [Revenue Last Year (Country)]
)


ðŸ”µ STATE-LEVEL ANALYTICS
/*
    Measure: Revenue by State
    Old Name: Revenue (State)
    Purpose: Total revenue grouped at the state level.
*/
Revenue by State :=
CALCULATE([Revenue Total], 'stores'[State])

/*
    Measure: Profit by State
    Old Name: Profit (State)
    Purpose: Profit contribution from each state. Used in the Top/Bottom 6 visuals.
*/
Profit by State :=
CALCULATE([Profit Total], 'stores'[State])

/*
    Measure: Revenue Share Percentage (State)
    Old Name: Revenue Share % (State)
    Purpose: Percentage contribution of each state to total revenue.
*/
Revenue Share Percentage (State) :=
DIVIDE([Revenue by State], [Revenue Without Filters])


ðŸ”µ STORE-LEVEL METRICS
/*
    Measure: Revenue by Store
    Old Name: Revenue (Store)
    Purpose: Total revenue generated by each store.
*/
Revenue by Store :=
CALCULATE([Revenue Total], 'stores'[StoreKey])

/*
    Measure: Revenue by Store
    Old Name: Revenue (Store)
    Purpose: Total revenue generated by each store.
*/
Revenue by Store :=
CALCULATE([Revenue Total], 'stores'[StoreKey])

/*
    Measure: Profit Margin Percentage by Store
    Old Name: Profit Margin % (Store)
    Purpose: Store-level profitability measure.
*/
Profit Margin Percentage by Store :=
DIVIDE([Profit by Store], [Revenue by Store])


ðŸ”µ STORE EFFICIENCY (CORE KPI)
/*
    Measure: Sales per Square Meter
    Old Name: Sales/sqm
    Purpose: Key metric measuring store productivity relative to floor space.
*/
Sales per Square Meter :=
DIVIDE([Revenue by Store], SUM('stores'[SquareMeters]))

/*
    Measure: Revenue per Store
    Old Name: Revenue per Store
    Purpose: Simple revenue figure shown in store efficiency matrices.
*/
Revenue per Store :=
[Revenue by Store]

/*
    Measure: Average Sales per Square Meter
    Old Name: Avg Sales/sqm
    Purpose: Benchmark reference line for store efficiency visuals.
*/
Average Sales per Square Meter :=
AVERAGEX(
    VALUES('stores'[StoreKey]),
    [Sales per Square Meter]
)

/*
    Measure: Store Efficiency Score
    Old Name: Efficiency Score (Store)
    Purpose: Combined metric blending sales per sqm and profit margin.
*/
Store Efficiency Score :=
([Sales per Square Meter] * 0.6) +
([Profit Margin Percentage by Store] * 0.4)


ðŸ”µ TOP/BOTTOM STORE IDENTIFICATION
/*
    Measure: Top Stores (Efficiency)
    Old Name: Top 6 Stores
    Purpose: Returns the top 6 stores based on sales per square meter.
*/
Top Stores (Efficiency) :=
TOPN(6, VALUES('stores'[StoreKey]), [Sales per Square Meter], DESC)

/*
    Measure: Bottom Stores (Efficiency)
    Old Name: Bottom 6 Stores
    Purpose: Returns the bottom 6 stores using the same efficiency metric.
*/
Bottom Stores (Efficiency) :=
TOPN(6, VALUES('stores'[StoreKey]), [Sales per Square Meter], ASC)


ðŸ”µ REGIONAL PROFIT CONTRIBUTION (STACKED AREA CHART)
/*
    Measure: Profit Contribution Percentage (Country)
    Old Name: Profit Contribution % (Country)
    Purpose: Percentage of total profit contributed by each country over time.
*/
Profit Contribution Percentage (Country) :=
DIVIDE([Profit by Country], CALCULATE([Profit Total], ALL('stores'[Country])))

/*
    Measure: Profit Contribution Percentage (Category)
    Old Name: Profit Contribution % (Category)
    Purpose: Used for toggling the stacked area chart between country/category.
*/
Profit Contribution Percentage (Category) :=
DIVIDE([Profit Total], CALCULATE([Profit Total], ALL('products'[Category])))